<!DOCTYPE html>
<html>
<body style="margin:0;">
<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

// ================== 画布尺寸 ==================
const BASE_WIDTH = 1260;
const BASE_HEIGHT = 2736;
canvas.width = BASE_WIDTH;
canvas.height = BASE_HEIGHT;

// ================== 日历缩放因子 ==================
const CALENDAR_SCALE = 1.25;

// ================== 背景 ==================
ctx.fillStyle = "#141414";
ctx.fillRect(0, 0, canvas.width, canvas.height);

// ================== 预留区域 ==================
const TOP_RESERVED = 420;
const BOTTOM_RESERVED = 420;

const CALENDAR_TOP = TOP_RESERVED;
const CALENDAR_BOTTOM = canvas.height - BOTTOM_RESERVED;
const CALENDAR_HEIGHT = CALENDAR_BOTTOM - CALENDAR_TOP;

// ================== 日期 ==================
const today = new Date();
const year = today.getFullYear();
const startOfYear = new Date(year, 0, 1);
const dayOfYear =
  Math.floor((today - startOfYear) / 86400000) + 1;

// ================== 年度进度 ==================
const endOfYear = new Date(year, 11, 31);
const daysInYear =
  Math.floor((endOfYear - startOfYear) / 86400000) + 1;

const progressPercent = Math.floor((dayOfYear / daysInYear) * 100);
const daysLeft = daysInYear - dayOfYear;

// ================== 灰色主题 ==================
const GRAY_THEMES = {
  soft: "#2c2c2e",
  medium: "#3a3a3c",
  warm: "#3f3f46",
  cool: "#303036",
  strong: "#48484a"
};
const FUTURE_DAY_COLOR = GRAY_THEMES.medium;

// ================== 月份数据 ==================
const months = [
  { name: "Jan", days: 31 },
  { name: "Feb", days: new Date(year, 1, 29).getMonth() === 1 ? 29 : 28 },
  { name: "Mar", days: 31 },
  { name: "Apr", days: 30 },
  { name: "May", days: 31 },
  { name: "Jun", days: 30 },
  { name: "Jul", days: 31 },
  { name: "Aug", days: 31 },
  { name: "Sep", days: 30 },
  { name: "Oct", days: 31 },
  { name: "Nov", days: 30 },
  { name: "Dec", days: 31 },
];

// ================== 日历基础尺寸 ==================
const MONTHS_PER_ROW = 3;
const cols = 7;
const size = 22;
const gap = 10;
const monthTitleHeight = 36;
const titleGap = 14;
const monthBlockGap = 36;
const rowGap = 60;

// ================== 单个月高度 ==================
function monthHeight(days, monthIndex) {
  const firstDay = new Date(year, monthIndex, 1).getDay();
  const offset = (firstDay + 6) % 7;
  const totalCells = offset + days;
  const rows = Math.ceil(totalCells / cols);

  return (
    monthTitleHeight +
    titleGap +
    rows * size +
    (rows - 1) * gap
  );
}

const maxMonthHeight = Math.max(
  ...months.map((m, i) => monthHeight(m.days, i))
);

// ================== 整体日历高度 ==================
const rows = 4;
const calendarHeight =
  rows * maxMonthHeight +
  (rows - 1) * rowGap;

const scaledCalendarHeight = calendarHeight * CALENDAR_SCALE;
const calendarStartY =
  CALENDAR_TOP +
  (CALENDAR_HEIGHT - scaledCalendarHeight) / 2;

// ================== 绘制日历（缩放） ==================
ctx.save();
ctx.translate(canvas.width / 2, calendarStartY);
ctx.scale(CALENDAR_SCALE, CALENDAR_SCALE);
ctx.translate(-canvas.width / 2, 0);

let cursorY = 0;
let dayCounter = 1;

for (let r = 0; r < rows; r++) {
  const rowMonths = months.slice(
    r * MONTHS_PER_ROW,
    r * MONTHS_PER_ROW + MONTHS_PER_ROW
  );

  const monthWidth = cols * size + (cols - 1) * gap;
  const rowWidth =
    MONTHS_PER_ROW * monthWidth +
    (MONTHS_PER_ROW - 1) * monthBlockGap;

  let cursorX = (canvas.width - rowWidth) / 2;

  rowMonths.forEach((month, mIndex) => {
    const monthIndex = r * MONTHS_PER_ROW + mIndex;

    ctx.fillStyle = "#8e8e93";
    ctx.font = "32px -apple-system";
    ctx.textAlign = "center";
    ctx.fillText(
      month.name,
      cursorX + monthWidth / 2,
      cursorY + monthTitleHeight - 6
    );

    const firstDay = new Date(year, monthIndex, 1).getDay();
    const offset = (firstDay + 6) % 7;
    const yStart = cursorY + monthTitleHeight + titleGap;

    for (let i = 0; i < month.days; i++) {
      const index = offset + i;
      const x = cursorX + (index % cols) * (size + gap);
      const y = yStart + Math.floor(index / cols) * (size + gap);

      if (dayCounter < dayOfYear) ctx.fillStyle = "#f2f2f7";
      else if (dayCounter === dayOfYear) ctx.fillStyle = "#ff453a";
      else ctx.fillStyle = FUTURE_DAY_COLOR;

      ctx.beginPath();
      ctx.arc(x + size/2, y + size/2, size/2, 0, Math.PI*2);
      ctx.fill();

      if (dayCounter === dayOfYear) {
        ctx.strokeStyle = "rgba(255,69,58,0.6)";
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(x + size/2, y + size/2, size/2 + 3, 0, Math.PI*2);
        ctx.stroke();
      }

      dayCounter++;
    }

    cursorX += monthWidth + monthBlockGap;
  });

  cursorY += maxMonthHeight + rowGap;
}

ctx.restore();

// ================== 年度进度（贴着日历底部） ==================
ctx.fillStyle = "#8e8e93";
ctx.font = "48px -apple-system";
ctx.textAlign = "center";

const progressY = calendarStartY + scaledCalendarHeight + 80;

ctx.fillText(
  `${progressPercent}% · ${daysLeft}d left`,
  canvas.width / 2,
  progressY
);
</script>
</body>
</html>
